# Week 1 Day 1: 有限域与椭圆曲线基础

> 学习日期: 2026-02-03

---

## 一、为什么需要有限域？

区块链密码学需要在有限范围内做运算，避免数字"爆炸"到无穷大。

**有限域 F_p** = {0, 1, 2, ..., p-1}，所有运算结果 mod p，保证结果仍在集合内。

---

## 二、模运算 (Modular Arithmetic)

```
a mod n = a 除以 n 的余数

例：17 mod 5 = 2
    -3 mod 7 = 4  (注意负数处理)
```

### 性质
```
(a + b) mod n = ((a mod n) + (b mod n)) mod n
(a × b) mod n = ((a mod n) × (b mod n)) mod n
```

---

## 三、模逆元

**定义：** a 的逆元 a⁻¹ 满足 `a × a⁻¹ ≡ 1 (mod p)`

**费马小定理：** a^(p-1) ≡ 1 (mod p)

**求逆元公式：** a⁻¹ = a^(p-2) mod p

```
例：在 F_7 中，4 的逆元
4^(7-2) mod 7 = 4^5 mod 7 = 1024 mod 7 = 2

验证：4 × 2 = 8 mod 7 = 1 ✓
```

---

## 四、群 (Group)

集合 + 运算，满足：
1. **封闭性** - 运算结果还在集合里
2. **结合律** - (a·b)·c = a·(b·c)
3. **单位元** - 存在 e 使 a·e = a
4. **逆元** - 每个 a 有 a⁻¹

**乘法群 F_p\*** = {1, 2, ..., p-1}（去掉 0）

---

## 五、生成元与阶

**生成元 g：** 通过 g^1, g^2, ... g^(p-1) 能生成整个群

**阶：** 使 g^k = 1 的最小正整数 k

```
F_7* 中，3 是生成元：
3^1=3, 3^2=2, 3^3=6, 3^4=4, 3^5=5, 3^6=1
生成了 {3,2,6,4,5,1} = 整个 F_7*
```

---

## 六、椭圆曲线

### 方程
```
y² = x³ + ax + b (mod p)
```

### secp256k1 (比特币/以太坊)
```
y² = x³ + 7 (mod p)

p = 2^256 - 2^32 - 977
```

---

## 七、点加法

两点 P、Q 相加得到第三点 R：

**几何意义：** 过 P、Q 画直线，交曲线于第三点，关于 x 轴对称

**公式 (P ≠ Q)：**
```
λ = (y₂ - y₁) / (x₂ - x₁) mod p
x₃ = λ² - x₁ - x₂ mod p
y₃ = λ(x₁ - x₃) - y₁ mod p
```

**公式 (P = Q，点倍乘)：**
```
λ = (3x₁² + a) / (2y₁) mod p
```

---

## 八、标量乘法

```
k × G = G + G + ... + G (k 次)
```

**Double-and-Add 算法：** O(log k) 复杂度

```
13 × G = (1101)₂ × G = 8G + 4G + G
只需 4 次倍乘 + 3 次加法
```

---

## 九、secp256k1 参数

```
p  = FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F
Gx = 79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798
Gy = 483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8
n  = FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141
```

- **G** 是全球统一的生成元，只有 1 个
- **n** 是 G 的阶（约 1.16 × 10^77）

---

## 十、密钥与地址

### 基本关系
```
私钥 k (随机数, 1 ≤ k < n)
    ↓ 标量乘法
公钥 P = k × G (椭圆曲线上的点)
    ↓ 哈希
地址
```

### 核心结论
| 关系 | 对应 |
|------|------|
| 私钥 → 公钥 | **1 : 1** |
| 公钥表示形式 | 压缩 (33字节) / 非压缩 (65字节) |

### 公钥压缩
```
非压缩: 04 + x (32字节) + y (32字节)
压缩:   02/03 + x (32字节)
  02 = y 是偶数
  03 = y 是奇数
```

---

## 十一、HD 钱包派生

**BIP-32/39/44：** 一个种子派生无限地址

```
助记词 (24 words)
    ↓
主私钥 + 链码
    ↓
    ├── m/44'/0'/0'/0/0 → 子私钥₀ → 地址₀
    ├── m/44'/0'/0'/0/1 → 子私钥₁ → 地址₁
    └── ...
```

**派生公式：**
```
子私钥 = (父私钥 + HMAC-SHA512(链码, 父公钥||索引)) mod n
```

**关键点：**
- 派生是生成"新的私钥"
- 每个子私钥仍然 1:1 对应一个公钥
- 只需备份助记词

---

## 十二、安全性来源

**离散对数问题 (ECDLP)：**
```
已知: G, P = k × G
求: k = ?

正向: 毫秒级
反向: 需要 2^128 次运算，不可能
```

---

## 学习心得

1. 有限域是一切的基础，保证运算不溢出
2. 费马小定理让求逆元变得简单
3. 标量乘法是椭圆曲线密码学的核心操作
4. 一个私钥只对应一个公钥（1:1），但可以派生出无限个子私钥
5. G 是公共参数，全球统一

---

## 明日计划

Week 1 Day 2: 完整实现椭圆曲线类，包括：
- Point 类
- EllipticCurve 类
- secp256k1 参数验证
- 签名生成/验证预览
