# Week 1 Day 2 补充：群、点倍乘、ECDSA 与 secp256k1

**日期：** 2026-02-04  
**主题：** 椭圆曲线密码学核心概念补充

---

## 一、群（Group）回顾

### 1.1 一句话定义

**群**就是一个集合 + 一种运算，满足 4 条规则。

### 1.2 生活类比：整数加法

整数 {..., -2, -1, 0, 1, 2, ...} 配上加法 `+`，就是一个群：

| 规则 | 名称 | 例子 |
|------|------|------|
| 1. 封闭性 | 两个整数相加还是整数 | 3 + 5 = 8 ✓ |
| 2. 结合律 | 先算谁都一样 | (1+2)+3 = 1+(2+3) = 6 ✓ |
| 3. 单位元 | 有个"什么都不变"的元素 | 5 + **0** = 5 ✓ |
| 4. 逆元 | 每个元素都有个"对手"能抵消它 | 5 + **(-5)** = 0 ✓ |

### 1.3 四条公理

设集合 G 和运算 ∘，构成群需要：

```
1. 封闭性:  a ∘ b ∈ G           （结果还在集合里）
2. 结合律:  (a ∘ b) ∘ c = a ∘ (b ∘ c)
3. 单位元:  存在 e，使 a ∘ e = a
4. 逆元:    对每个 a，存在 a⁻¹，使 a ∘ a⁻¹ = e
```

### 1.4 哪些是群？哪些不是？

| 集合 + 运算 | 是群？ | 原因 |
|-------------|--------|------|
| 整数 + 加法 | ✅ | 满足全部 4 条 |
| 整数 + 乘法 | ❌ | 逆元不存在（5 的逆元 1/5 不是整数） |
| 正整数 + 加法 | ❌ | 没有单位元（0 不是正整数） |
| 非零实数 + 乘法 | ✅ | 单位元是 1，逆元是 1/a |

### 1.5 椭圆曲线上的群

椭圆曲线上所有的点 + 点加法运算，构成一个群：

| 规则 | 椭圆曲线版本 |
|------|-------------|
| 封闭性 | P + Q 还是曲线上的点 |
| 结合律 | (P + Q) + R = P + (Q + R) |
| 单位元 | 无穷远点 O（P + O = P） |
| 逆元 | -P = (x, -y)（P + (-P) = O） |

---

## 二、点倍乘（Point Doubling）

### 2.1 定义

**点倍乘就是 P + P，一个点加自己。**

```
P + P = 2P
```

结果是原来的"2倍"，所以叫**倍乘**（Doubling）。

### 2.2 几何上怎么做？

普通点加法：过 P 和 Q 两点画直线。

但 P + P 只有一个点，怎么画直线？

**答案：画切线！**

```
        y
        │
        │      ╱ ← 在 P 点的切线
        │    P•╱
        │    ╱
        │   ╱
        │  ╱
        │─╱────────────────── x
        │╱
        •  R' (切线与曲线的另一个交点)
        │
        •  R = 2P (R' 关于 x 轴对称)
```

步骤：
1. 在点 P 画曲线的**切线**
2. 切线与曲线相交于另一点 R'
3. R' 关于 x 轴对称得到 R
4. **R = 2P**

### 2.3 公式

切线斜率（对 y² = x³ + ax + b 求导）：

```
λ = (3x₁² + a) / (2y₁)
```

结果坐标：

```
x₂ = λ² - 2x₁
y₂ = λ(x₁ - x₂) - y₁
```

---

## 三、点倍乘 vs 标量乘法

### 3.1 关系

**点倍乘是标量乘法的一个特例。**

```
点倍乘:   2P = P + P         （只算 2 倍）
标量乘法: kP = P + P + ... + P （算 k 倍，k 是任意整数）
```

### 3.2 关系图

```
标量乘法 kP
    │
    ├── k=2  →  2P = P + P      ← 点倍乘
    ├── k=3  →  3P = P + P + P
    ├── k=4  →  4P = P + P + P + P
    └── k=n  →  nP = P + P + ... + P (n个)
```

### 3.3 为什么要单独讲点倍乘？

**原因 1：公式不同**

```java
if (P.equals(Q)) {
    // 点倍乘：用切线公式
    lambda = (3 * x1² + a) / (2 * y1);
} else {
    // 点加法：用两点斜率公式
    lambda = (y2 - y1) / (x2 - x1);
}
```

**原因 2：Double-and-Add 算法的核心**

```
计算 11P：

11 = 1011₂ = 8 + 2 + 1

P  → 2P → 4P → 8P     ← 反复点倍乘！
         ↓
11P = 8P + 2P + P      ← 然后点加法组合
```

### 3.4 总结

| 概念 | 定义 | 用途 |
|------|------|------|
| 点加法 | P + Q（两个不同点） | 基础运算 |
| 点倍乘 | 2P = P + P（同一个点） | 点加法的特例，公式不同 |
| 标量乘法 | kP（k 个 P 相加） | 用点加法 + 点倍乘实现 |

---

## 四、椭圆曲线与比特币密码学

### 4.1 密钥生成

```
私钥 k (随机数，256位)
    │
    │  标量乘法
    ▼
公钥 K = k × G
    │
    │  哈希
    ▼
比特币地址
```

### 4.2 secp256k1 参数

比特币用的曲线参数：

```
曲线:  y² = x³ + 7

素数 p = 2²⁵⁶ - 2³² - 977（超级大）

生成元 G = (
  0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798,
  0x483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8
)
```

### 4.3 为什么安全？（ECDLP）

```
正向（快）:  k → K = kG     几百次运算，毫秒级
逆向（难）:  K → k = ?      没有有效算法，暴力需 2²⁵⁶ 次尝试
```

这就是 **椭圆曲线离散对数问题（ECDLP）**。

打个比方：

```
正向: 知道起点 G，走 k 步，告诉你终点 K     → 容易
逆向: 知道起点 G 和终点 K，问走了几步？    → 极难
```

---

## 五、secp256k1 vs ECDSA

### 5.1 一句话区别

```
secp256k1 = 一条具体的椭圆曲线（参数）
ECDSA     = 一种签名算法（方法）
```

**类比**：

```
secp256k1 → 食材
ECDSA     → 菜谱
```

### 5.2 层级关系

```
椭圆曲线密码学 (ECC)
    │
    ├── 椭圆曲线（选哪条曲线？）
    │       ├── secp256k1  ← 比特币用这条
    │       ├── secp256r1  ← 又叫 P-256，政府/银行常用
    │       ├── Curve25519 ← Signal、SSH 用
    │       └── ...
    │
    └── 算法（用曲线干什么？）
            ├── ECDSA      ← 签名算法
            ├── ECDH       ← 密钥交换
            ├── Schnorr    ← 另一种签名（比特币 Taproot 用）
            └── ...
```

### 5.3 secp256k1 命名

```
sec   = Standards for Efficient Cryptography
p     = 素数域
256   = 256 位
k     = Koblitz 曲线
1     = 第一条
```

### 5.4 ECDSA 签名流程

**Elliptic Curve Digital Signature Algorithm**

```
签名（证明我有私钥）:
─────────────────────
输入: 私钥 d, 消息 m
1. 算消息哈希 e = hash(m)
2. 随机数 k
3. 算点 R = kG，取 r = R.x
4. 算 s = (e + r×d) / k
5. 输出签名 (r, s)


验证（检查签名对不对）:
─────────────────────
输入: 公钥 Q, 消息 m, 签名 (r, s)
1. 算消息哈希 e = hash(m)
2. 算 u₁ = e/s, u₂ = r/s
3. 算点 R' = u₁G + u₂Q
4. 检查 R'.x == r ?
```

### 5.5 比特币的组合

```
曲线:    secp256k1
算法:    ECDSA（正在迁移到 Schnorr）
哈希:    SHA-256 + RIPEMD-160
```

### 5.6 其他常见组合

| 组合 | 谁在用 |
|------|--------|
| secp256k1 + ECDSA | 比特币（传统） |
| secp256k1 + Schnorr | 比特币（Taproot） |
| secp256r1 + ECDSA | TLS、政府系统 |
| Curve25519 + EdDSA | Signal、SSH |

### 5.7 总结表格

| | secp256k1 | ECDSA |
|---|-----------|-------|
| 是什么 | 曲线参数 | 签名算法 |
| 回答什么问题 | 在哪条曲线上算？ | 怎么签名/验证？ |
| 能单独用吗 | 不能，只是参数 | 不能，需要指定曲线 |
| 类比 | 食材 | 菜谱 |

---

## 六、椭圆曲线 ≠ 椭圆！

常见误解：把椭圆曲线和椭圆搞混。

**椭圆**（Ellipse）：

```
        ╭────────╮
       ╱          ╲
      │            │
       ╲          ╱
        ╰────────╯
```

**椭圆曲线**（Elliptic Curve，y² = x³ + ax + b）：

```
        y
        │
        │    ╭───╮
        │   ╱     ╲
        │  ╱       ╲
        │ │         ╲
────────┼─┼──────────╲───── x
        │ │          ╱
        │  ╲        ╱
        │   ╲      ╱
        │    ╰───╯╱
        │        ╱  (向右无限延伸)
```

椭圆曲线有两部分：
- **左边**：一个封闭的"水滴"形状
- **右边**：一条向右上/右下无限延伸的曲线

**直线与椭圆曲线可以有 3 个交点**（因为是三次方程），这是点加法的数学基础。

---

## 参考资料

- 《Serious Cryptography》Chapter 11-12
- [SEC 2: Recommended Elliptic Curve Domain Parameters](https://www.secg.org/sec2-v2.pdf)
- [比特币 BIP-340 (Schnorr)](https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki)
