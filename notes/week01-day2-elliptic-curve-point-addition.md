# Week 1 Day 2: 椭圆曲线点加法与标量乘法

**日期：** 2026-02-04  
**主题：** 椭圆曲线点加法、标量乘法

---

## 一、什么是椭圆曲线？

### 1.1 数学定义

椭圆曲线的标准形式（Weierstrass 形式）：
y² = x³ + ax + b


其中 a 和 b 是常数，且需要满足 **4a³ + 27b² ≠ 0**（保证曲线没有奇点/尖点）。

### 1.2 几个例子
y² = x³ - x (a = -1, b = 0)
y² = x³ - x + 1 (a = -1, b = 1)
y² = x³ + 7 (a = 0, b = 7) ← 这就是比特币用的 secp256k1！


### 1.3 曲线长什么样？

在实数域上，椭圆曲线是一条关于 x 轴对称的光滑曲线。

**关键特性：** 曲线关于 x 轴对称。如果 (x, y) 在曲线上，那么 (x, -y) 也在曲线上。

---

## 二、椭圆曲线上的"点"

### 2.1 普通点

任何满足 y² = x³ + ax + b 的坐标 (x, y) 都是曲线上的点。

### 2.2 无穷远点 O（单位元）

椭圆曲线还有一个特殊的点叫 **无穷远点**，记作 **O** 或 **∞**。

**它的作用**：在点加法中充当"零元"，就像普通加法中的 0：
- P + O = P
- O + P = P

---

## 三、点加法（Point Addition）

### 3.1 几何直觉

**规则**：过曲线上两点 P 和 Q 画一条直线，这条线会与曲线相交于第三点 R'，然后将 R' 关于 x 轴对称得到 R。

**定义**：P + Q = R

### 3.2 代数公式（P ≠ Q 时）

设 P = (x₁, y₁)，Q = (x₂, y₂)，求 R = P + Q = (x₃, y₃)

**第一步：计算斜率 λ（lambda）**
λ = (y₂ - y₁) / (x₂ - x₁)


**第二步：计算 R 的坐标**
x₃ = λ² - x₁ - x₂
y₃ = λ(x₁ - x₃) - y₁


### 3.3 具体例子

假设曲线 y² = x³ - 7x + 10

P = (1, 2)，Q = (3, 4)

计算 P + Q：
λ = (4 - 2) / (3 - 1) = 2 / 2 = 1

x₃ = 1² - 1 - 3 = -3
y₃ = 1 × (1 - (-3)) - 2 = 2

R = (-3, 2)


---

## 四、点倍乘（Point Doubling）

### 4.1 问题：P + P = ?

当 P = Q 时，两点重合，不能直接画"过两点的直线"。

**解决方案**：画曲线在 P 点的**切线**！

### 4.2 代数公式（P = Q 时）

设 P = (x₁, y₁)，求 2P = (x₃, y₃)

**切线斜率：**
λ = (3x₁² + a) / (2y₁)


**坐标计算：**
x₃ = λ² - 2x₁
y₃ = λ(x₁ - x₃) - y₁


---

## 五、特殊情况处理

### 5.1 P + O = P

无穷远点是单位元。

### 5.2 P + (-P) = O

如果 P = (x, y)，那么 -P = (x, -y)（关于 x 轴对称）。

它们相加时，连线是**垂直线**，与曲线"相交于无穷远点"。

### 5.3 y₁ = 0 时的点倍乘

如果 P = (x, 0)，切线斜率公式中分母为 0，2P = O。

---

## 六、标量乘法（Scalar Multiplication）

### 6.1 定义

给定点 P 和整数 n，计算：
nP = P + P + P + ... + P (n 个 P 相加)


### 6.2 快速方法：倍加法（Double-and-Add）

**核心思想**：利用二进制展开

例如计算 21P：
21 = 10101₂ = 16 + 4 + 1 = 2⁴ + 2² + 2⁰

所以 21P = 16P + 4P + P


### 6.3 算法伪代码
def double_and_add(n, P):
result = O # 无穷远点
temp = P # 当前的 2^i × P

while n > 0:
    if n & 1:       # 如果 n 的最低位是 1
        result = result + temp
    temp = 2 × temp
    n >>= 1

return result

### 6.4 手算例子：计算 11P
11 = 1011₂

第1轮: n & 1 = 1, result = P, temp = 2P, n = 5
第2轮: n & 1 = 1, result = 3P, temp = 4P, n = 2
第3轮: n & 1 = 0, result = 3P, temp = 8P, n = 1
第4轮: n & 1 = 1, result = 11P

输出: 11P


只用了 **3 次点加法 + 4 次点倍乘 = 7 次运算**，而不是 11 次！

---

## 七、有限域上的椭圆曲线

### 7.1 为什么要有限域？

实数域上的坐标是无限精度小数，计算机无法精确表示。

**解决方案**：在有限域 Fp 上定义椭圆曲线。
y² ≡ x³ + ax + b (mod p)


### 7.2 点加法公式（有限域版）

公式完全一样，但所有运算都是 mod p：
λ = (y₂ - y₁) × (x₂ - x₁)⁻¹ (mod p)
x₃ = λ² - x₁ - x₂ (mod p)
y₃ = λ(x₁ - x₃) - y₁ (mod p)


注意：除法变成乘以**模逆元**。

---

## 八、椭圆曲线密码学的安全性

### 8.1 离散对数问题（ECDLP）

已知点 P 和 Q = nP，求 n。

**这个问题极其困难！** 目前没有多项式时间算法。

### 8.2 与 RSA 对比

| 安全级别 | RSA 密钥长度 | ECC 密钥长度 |
|---------|-------------|-------------|
| 80 bit  | 1024 bit    | 160 bit     |
| 128 bit | 3072 bit    | 256 bit     |
| 256 bit | 15360 bit   | 512 bit     |

**ECC 用更短的密钥达到相同安全性！**

### 8.3 单向门函数
正向（快）: 私钥 k → 公钥 K = kG ← O(256) 次运算
逆向（难）: 公钥 K → 私钥 k = ? ← 无有效算法


这就是比特币/以太坊地址安全性的数学基础！

---

## 九、今日练习

1. **手算练习**：在曲线 y² = x³ + 7 (mod 23) 上，设 P = (7, 11)，计算 2P 和 3P

2. **思考题**：为什么 double-and-add 的时间复杂度是 O(log n)？

3. **代码练习**：运行 Java 代码，尝试不同的点和标量

---

## 参考资料

- 《Serious Cryptography》Chapter 11-12
- [evm.codes](https://evm.codes) - EVM opcode 可视化
- [Desmos 椭圆曲线可视化](https://www.desmos.com/calculator)